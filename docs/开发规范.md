# ARL-TI 项目开发规范

## 1. 概述

本文档定义了ARL-TI项目的开发规范，包括代码风格、提交规范、注释规范、测试规范等。

## 2. 代码提交规范

### 2.1 Commit Message 格式

使用 Angular 风格的提交信息格式：

```
<type>(<scope>): <subject>

<body>

<footer>
```

#### 类型 (Type)

- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `style`: 代码格式调整 (不影响功能)
- `refactor`: 重构 (不新增功能，不修复bug)
- `test`: 测试相关
- `chore`: 构建过程或工具配置更新
- `perf`: 性能优化
- `ci`: CI配置更新
- `revert`: 回滚提交

#### 范围 (Scope)

- `frontend`: 前端相关
- `backend`: 后端相关
- `scripts`: 构建脚本
- `docker`: Docker配置
- `docs`: 文档
- `test`: 测试

#### 主题 (Subject)

- 使用中文，简洁明了，不超过50字符
- 首字母小写，不以句号结尾
- 另外我自己推送，只用打上commit就行了

#### 正文 (Body)

- 详细说明变更内容
- 解释变更的原因和影响
- 使用中文

#### 页脚 (Footer)

- 关联的Issue: `Closes #123`
- 破坏性变更: `BREAKING CHANGE: description`

### 2.2 示例

```
feat(frontend): 添加用户登录界面

- 新增登录表单组件
- 集成JWT认证
- 添加表单验证逻辑

Closes #45
```

```
fix(backend): 修复资产扫描任务超时问题

- 增加任务执行时间限制
- 添加超时自动重试机制
- 优化数据库连接池配置
```

## 3. 代码注释规范

如果有修改文件，请都打上注释，包括前后端，这样一点一点，代码注释就完整了

### 3.1 Python 代码注释

#### 模块级注释

```python
"""
功能说明：资产信息收集和处理模块

主要类/函数：
- AssetCollector: 资产收集器类
- process_asset: 资产处理函数
- validate_asset: 资产验证函数

应用场景：
- 网络资产发现
- 资产信息聚合
- 资产状态监控
"""
```

#### 类注释

```python
class AssetCollector:
    """
    资产收集器

    负责从各种来源收集网络资产信息，包括IP、域名、端口等。
    支持多线程并发收集，提高收集效率。
    """

    def collect_ips(self, target_range: str) -> List[str]:
        """
        收集指定范围内的IP地址

        Args:
            target_range: IP地址范围，如 "192.168.1.0/24"

        Returns:
            收集到的IP地址列表

        Raises:
            ValueError: 当IP范围格式无效时抛出
        """
```

#### 函数注释

```python
def process_asset(asset_data: Dict[str, Any]) -> Dict[str, Any]:
    """
    处理资产数据

    对收集到的资产数据进行清洗、验证和格式化处理。

    Args:
        asset_data: 原始资产数据字典

    Returns:
        处理后的资产数据字典

    Note:
        处理过程中会过滤无效数据并添加时间戳
    """
```

### 3.2 JavaScript/Vue 代码注释

#### 组件注释

```javascript
/**
 * 用户登录组件
 *
 * 提供用户登录界面和认证逻辑
 * 支持用户名密码登录和验证码验证
 */
export default {
  name: "LoginForm",
  // ...
};
```

#### 方法注释

```javascript
/**
 * 提交登录表单
 *
 * 验证表单数据并发送登录请求
 *
 * @param {Object} formData - 表单数据
 * @returns {Promise} 登录结果
 */
async submitLogin(formData) {
  // 验证逻辑
  // 发送请求
}
```

## 4. 代码风格规范

### 4.1 Python 代码风格

- 遵循 PEP 8 规范
- 使用 Black 代码格式化工具
- 最大行长度：88字符
- 使用类型注解
- 使用描述性变量名

### 4.2 JavaScript/Vue 代码风格

- 使用 ESLint 和 Prettier
- 使用 2 个空格缩进
- 使用单引号
- 使用分号
- 使用驼峰命名法

### 4.3 文件命名规范

- Python 文件：`snake_case.py`
- JavaScript 文件：`camelCase.js`
- Vue 组件：`PascalCase.vue`
- 测试文件：`test_*.py`, `*.spec.js`

## 5. 开发工作流

### 5.1 分支管理

- `main`: 主分支，生产环境代码

### 5.2 开发流程

1. 从 `develop` 分支创建功能分支
2. 在功能分支上开发
3. 提交符合规范的commit
4. 创建 Pull Request
5. Code Review 通过后合并

### 5.3 测试要求

- 新功能必须有单元测试
- 修改必须保证现有测试通过
- 核心功能要有集成测试
- 测试覆盖率不低于80%

## 6. 文档规范

### 6.1 README 文档

每个模块必须包含：

- 功能说明
- 安装使用方法
- 配置说明
- API文档
- 贡献指南

### 6.2 API 文档

- 使用 OpenAPI/Swagger 规范
- 包含请求/响应示例
- 详细的参数说明
- 错误码定义

## 7. 部署规范

### 7.1 Docker 构建

- 使用多阶段构建优化镜像大小
- 添加适当的标签和描述
- 遵循安全最佳实践

### 7.2 环境配置

- 使用环境变量管理配置
- 不同环境使用不同配置文件
- 敏感信息不提交到版本控制

## 8. 质量保证

### 8.1 代码审查

- 至少一人审查
- 检查代码风格和规范
- 验证测试覆盖
- 评估性能影响

### 8.2 自动化检查

- 使用 pre-commit hooks
- CI/CD 流水线包含：
  - 代码格式检查
  - 单元测试
  - 安全扫描
  - 性能测试

## 9. 安全规范

### 9.1 代码安全

- 输入验证和过滤
- SQL注入防护
- XSS防护
- CSRF防护

### 9.2 依赖管理

- 定期更新依赖包
- 使用安全扫描工具
- 避免使用有漏洞的包

## 10. 维护规范

### 10.1 版本管理

- 遵循语义化版本 (Semantic Versioning)
- 格式：MAJOR.MINOR.PATCH
- 维护更新日志

### 10.2 Issue 管理

- 使用清晰的标题
- 添加适当的标签
- 关联相关的Pull Request
- 及时关闭已解决的Issue

---

## 附录

### 常用工具

- **代码格式化**: Black (Python), Prettier (JavaScript)
- **代码检查**: Flake8 (Python), ESLint (JavaScript)
- **测试框架**: pytest (Python), Jest (JavaScript)
- **文档生成**: Sphinx (Python), JSDoc (JavaScript)

### 相关链接

- [Angular Commit Message Guidelines](https://github.com/angular/angular/blob/main/CONTRIBUTING.md#commit)
- [PEP 8 Style Guide](https://pep8.org/)
- [Vue Style Guide](https://vuejs.org/style-guide/)
